<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linea Token Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      color: white;
    }
    canvas#stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    .pulse-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 10px;
      display: inline-block;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.5); opacity: 1; }
      100% { transform: scale(1); opacity: 0.7; }
    }
    .footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      text-align: center;
      color: #aaa;
      font-size: 0.9rem;
    }
	
  </style>
</head>
<body>

<!-- Yıldızlı Arkaplan -->
<canvas id="stars"></canvas>

<!-- Token Kartı -->
<!-- Token Kartı -->
<div class="absolute inset-0 flex items-center justify-center">
  <div class="relative rounded-3xl p-8 w-11/12 max-w-md text-center liquid-glass">
    <h2 class="text-2xl font-bold text-white mb-6">Kontrattaki Token Miktarı</h2>
    <div class="flex items-center justify-center">
      <img src="https://app.aave.com/icons/networks/linea.svg" alt="Token Icon" class="w-10 h-10 mr-3">
      <span id="tokenBalance" class="text-4xl font-extrabold text-white-400 drop-shadow-lg">0</span>
      <span id="tokenStatusDot" class="pulse-dot bg-red-500"></span>
    </div>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  ❤️ Made with love by 
  <a href="https://x.com/KZMKBL" target="_blank" class="text-blue-400 hover:underline font-semibold">KZMKBL</a>
</div>

<script>
/* === STAR BACKGROUND === */
const canvas = document.getElementById("stars");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

let stars = [];
for (let i = 0; i < 250; i++) {
  stars.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    radius: Math.random() * 1.5,
    speed: Math.random() * 0.6 + 0.2
  });
}

function animateStars() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "white";
  stars.forEach(star => {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
    ctx.fill();

    star.y += star.speed;
    if (star.y > canvas.height) {
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }
  });

  requestAnimationFrame(animateStars);
}
animateStars();

/* === TOKEN & RPC === */
const claimContractAddress = "0x87bAa1694381aE3eCaE2660d97fe60404080Eb64";
const lineaTokenAddress = "0x1789e0043623282d5dcc7f213d703c6d8bafbb04";

const rpcs = [
  { url: "https://rpc.linea.build" },
  { url: "https://1rpc.io/linea" },
  { url: "https://linea-rpc.rpcdot.com" },
  { url: "https://linea.getanode.io" },
  { url: "https://linea2.getanode.io" }
];

const erc20ABI = [
  { "constant": true, "inputs": [{"name":"owner","type":"address"}], "name": "balanceOf", "outputs": [{"name":"","type":"uint256"}], "type": "function" },
  { "constant": true, "inputs": [], "name": "decimals", "outputs": [{"name":"","type":"uint8"}], "type": "function" }
];

let web3s = rpcs.map(r => new Web3(r.url));
let activeWeb3 = web3s[0];
let tokenContract = new activeWeb3.eth.Contract(erc20ABI, lineaTokenAddress);
let decimals;

const tokenBalanceDisplay = document.getElementById("tokenBalance");
const tokenStatusDot = document.getElementById("tokenStatusDot");

async function updateRpcStatus() {
  let foundWorking = false;

  for (let i = 0; i < rpcs.length; i++) {
    try {
      await web3s[i].eth.getBlockNumber();
      if (!foundWorking) {
        activeWeb3 = web3s[i];
        tokenContract = new activeWeb3.eth.Contract(erc20ABI, lineaTokenAddress);
        foundWorking = true;
      }
    } catch {}
  }

  if (!foundWorking) {
    tokenStatusDot.classList.remove("bg-green-500");
    tokenStatusDot.classList.add("bg-red-500");
  }
}
setInterval(updateRpcStatus, 2000);

async function updateTokenBalance() {
  try {
    if (!decimals) decimals = await tokenContract.methods.decimals().call();
    
    const balanceBN = await tokenContract.methods.balanceOf(claimContractAddress).call();
    const balance = activeWeb3.utils.toBN(balanceBN);
    const divisor = activeWeb3.utils.toBN(10).pow(activeWeb3.utils.toBN(decimals));
    
    const adjusted = parseFloat(balance.div(divisor).toString() + "." + balance.mod(divisor).toString().slice(0,4));
    tokenBalanceDisplay.innerText = adjusted.toLocaleString();

    tokenStatusDot.classList.remove("bg-red-500","bg-green-500");
    tokenStatusDot.classList.add(balance.gte(activeWeb3.utils.toBN(0)) ? "bg-green-500" : "bg-red-500");

  } catch(err){
    console.error("Token balance kontrol hatası:", err);
    tokenStatusDot.classList.remove("bg-green-500");
    tokenStatusDot.classList.add("bg-red-500");
  }
}
setInterval(updateTokenBalance, 2000);
</script>

</body>
</html>

